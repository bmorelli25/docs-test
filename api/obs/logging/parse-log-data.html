<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Filter and aggregate logs" href="filter-and-aggregate-logs.html" /><link rel="prev" title="PRODUCT_NAME log sending" href="send-application-logs.html" />

    <!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06.dev1 -->
        <title>Parse and route logs - Elastic documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=4a3d756c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <!-- DESKTOP HEADER -->
  <header class="header">
    <a class="header__logo" href="#">CWK</a>
    <div class="header__toggle">
        <i class="bx bx-menu" id="header-toggle"></i>
    </div>
    <nav class="nav" id="nav-menu">
        <div class="nav__content bg-grid">
            <a class="nav__profil" href="#">
                <div class="nav__img">
                    <img src="https://codwerk.github.io/assets/images/logo_codwerk-new.png" alt="" />
                </div>
                <div>
                    <span class="nav__name">Elastic Docs</span>
                </div>
            </a>
            <div class="nav__menu">
                <ul class="nav__list">
                    <li class="nav__item"><a class="nav__link" href="#">Get Started</a></li>
                    <li class="nav__item dropdown">
                        <a class="nav__link dropdown__link" href="#">
                            Solutions<i class="bx bx-chevron-down dropdown__icon"></i>
                            <ul class="dropdown__menu">
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Search</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Security</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Observability</a>
                                </li>
                            </ul>
                        </a>
                    </li>
                    <li class="nav__item dropdown">
                      <a class="nav__link dropdown__link" href="#">
                          Platform
                          <i class="bx bx-chevron-down dropdown__icon"></i>
                          <ul class="dropdown__menu">
                              <li class="dropdown__item">
                                  <a class="nav__link" href="#">Elasticsearch</a>
                              </li>
                              <li class="dropdown__item">
                                  <a class="nav__link" href="#">Logstash</a>
                              </li>
                              <li class="dropdown__item">
                                  <a class="nav__link" href="#">Beats</a>
                              </li>
                          </ul>
                      </a>
                  </li>
                    <li class="nav__item dropdown">
                        <a class="nav__link dropdown__link" href="#">
                            API
                            <i class="bx bx-chevron-down dropdown__icon"></i>
                            <ul class="dropdown__menu">
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Elasticsearch</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Logstash</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Beats</a>
                                </li>
                            </ul>
                        </a>
                    </li>
                    <li class="nav__item">
                        <a class="nav__link" href="#">Release Docs</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

  <!-- MOBILE HEADER -->
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Elastic  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Elastic  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search me" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Observability</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Observability</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../observability-overview.html">Observability overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../elastic-entity-model.html">Elastic Entity Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/create-an-observability-project.html">Create an Elastic Observability project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/billing.html">Observability billing dimensions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apm/index.html">Application performance monitoring (APM)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Application performance monitoring (APM)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-distributed-tracing.html">Distributed tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-metrics.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-stacktrace-collection.html">Stacktrace collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-create-custom-links.html">Create custom links</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-data-types.html">APM data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-overview.html">Navigate the Applications UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-reference.html">Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-get-started.html">Get started with traces and APM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-kibana-settings.html">Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-logs.html">Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-transaction-sampling.html">Transaction sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-observe-lambda-functions.html">Observe Lambda functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-service-overview.html">Service Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-transactions.html">Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-track-deployments-with-annotations.html">Track deployments with annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-traces.html">Traces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/new-experience-services.html">New services experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-query-your-data.html">Query your data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-errors.html">Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-filter-your-data.html">Filter your data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-reduce-your-data-usage.html">Reduce your data usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-view-and-analyze-traces.html">View and analyze traces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-service-map.html">Service map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-services.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-integrate-with-machine-learning.html">Integrate with machine learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-problems.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-problems.html#no-data-is-indexed">No data is indexed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-response-codes.html">Troubleshooting two</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-response-codes.html#http-400-data-decoding-error-data-validation-error">HTTP 400: Data decoding error / Data validation error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-send-traces-to-elastic.html">Send APM data to Elastic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-transaction-sampling/configure-head-based-sampling.html">tran sampl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-transaction-sampling/configure-head-based-sampling.html#id1">tran sampl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-compress-spans.html">Compress spans</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-find-transaction-latency-and-failure-correlations.html">Find transaction latency and failure correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-dependencies.html">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-trace-sample-timeline.html">Trace sample timeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-server-api.html">Managed intake service event API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-infrastructure.html">Infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-keep-data-secure.html">Keep APM data secure</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Log monitoring</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Log monitoring</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="get-started-with-logs.html">Get started with system logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="stream-log-files.html">Stream any log file</a></li>
<li class="toctree-l3"><a class="reference internal" href="correlate-application-logs.html">Stream application logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="plaintext-application-logs.html">Plaintext application logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ecs-application-logs.html">ECS formatted application logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="send-application-logs.html">PRODUCT_NAME log sending</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Parse and route logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="filter-and-aggregate-logs.html">Filter and aggregate logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="view-and-monitor-logs.html">Explore logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="monitor-datasets.html">Monitor log data set quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="add-logs-service-name.html">Add a service name to logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="run-log-pattern-analysis.html">Run a pattern analysis on log data</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshoot-logs.html">Troubleshoot logs</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../synthetics/index.html">Synthetics</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Synthetics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-lightweight.html">Configure lightweight monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-manage-monitors.html">Manage monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-get-started-ui.html">Create monitors in the Synthetics UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-scale-and-architect.html">Scale and architect a Synthetics deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-create-test.html">Write a synthetic test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-manage-retention.html">Manage data retention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-configuration.html">Configure a Synthetics project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-params-secrets.html">Work with params and secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-settings.html">Configure Synthetics settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-get-started-project.html">Create monitors with a Synthetics project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-command-reference.html">Use the Synthetics CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-intro.html">Synthetic monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-journeys.html">Scripting browser monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-private-location.html">Monitor resources on private networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html">Use the Synthetics Recorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#record-a-journey">Record a journey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#edit-a-journey">Edit a journey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#test-the-journey">Test the journey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#export">Export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-analyze.html">Analyze data from synthetic monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-troubleshooting.html">Troubleshooting Synthetics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-monitor-use.html">Configure individual browser monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-feature-roles.html">Grant users access to secured resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-security-encryption.html">Synthetics Encryption and Security</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../alerting/index.html">Create and manage rules</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Create and manage rules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-slo-burn-rate-alert-rule.html">Create an SLO burn rate rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/triage-threshold-breaches.html">Triage threshold breaches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/view-alerts.html">View alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-inventory-threshold-alert-rule.html">Create an inventory rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/alerting.html">Alerting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/aiops-generate-anomaly-alerts.html">Create an anomaly detection rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-anomaly-alert-rule.html">Create an APM anomaly rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/aggregation-options.html">Aggregation options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-latency-threshold-alert-rule.html">Create a latency threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/triage-slo-burn-rate-breaches.html">Triage SLO burn rate breaches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-elasticsearch-query-alert-rule.html">Create an Elasticsearch query rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-custom-threshold-alert-rule.html">Create a custom threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/alerting-connectors.html">Alerting connectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-error-count-threshold-alert-rule.html">Create an error count threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/create-failed-transaction-rate-threshold-alert-rule.html">Create a failed transaction rate threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alerting/rate-aggregation.html">Rate aggregation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cases/index.html">Cases</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Cases</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cases/manage-cases-settings.html">Configure case settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cases/create-manage-cases.html">Create and manage cases</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../unsorted/index.html">Unsorted</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Unsorted</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-elastic-apm-agents.html">Elastic APM agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-collect-metrics.html">Collect metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-resource-attributes.html">Resource attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-opentelemetry-apisdk-with-elastic-apm-agents.html">OpenTelemetry API/SDK with Elastic APM agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-limitations.html">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-aws-lambda-functions.html">AWS Lambda functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-opentelemetry-native-support.html">OpenTelemetry native support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-other-execution-environments.html">AWS Lambda support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-anomalies.html">Detect anomalies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-anomalies.html#create-and-run-an-anomaly-detection-job">Create and run an anomaly detection job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-anomalies.html#view-the-results">View the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-forecast-anomaly.html">Forecast future behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-tune-anomaly-detection-job.html">Tune your anomaly detection job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-change-points.html">Detect change points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-analyze-spikes.html">Analyze log spikes and drops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops.html">AIOps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dashboards/dashboards-and-visualizations.html">Dashboards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/metrics-app-fields.html">Required fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/get-started-with-metrics.html">Get started with system metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/metrics-reference.html">Metrics reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/analyze-hosts.html">Analyze and compare hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/detect-metric-anomalies.html">Detect metric anomalies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/kubernetes-pod-metrics.html">Kubernetes pod metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/configure-infra-settings.html">Configure settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/docker-container-metrics.html">Docker container metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/view-infrastructure-metrics.html">View infrastructure metrics by resource type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/host-metrics.html">Host metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/aws-metrics.html">AWS metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/infra-monitoring.html">Infrastructure monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ai-assistant/ai-assistant.html">AI Assistant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slos/slos.html">SLOs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slos/create-an-slo.html">Create an SLO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../search/index.html">Elastic Search</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Elastic Search</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../search/bucket-1/index.html">Bucket 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../search/bucket-2/index.html">Bucket 2</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../sec/index.html">Elastic Security</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Elastic Security</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../sec/bucket-1/index.html">Bucket 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sec/bucket-2/index.html">Bucket 2</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/obs/logging/parse-log-data.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="parse-and-route-logs">
<h1>Parse and route logs<a class="headerlink" href="#parse-and-route-logs" title="Link to this heading">¶</a></h1>
<p><DocBadge template="technical preview" /></p>
<p>import Roles from ‘../partials/roles.mdx’</p>
<Roles role="Admin" goal="create ingest pipelines that parse and route logs" />
<p>If your log data is unstructured or semi-structured, you can parse it and break it into meaningful fields. You can use those fields to explore and analyze your data. For example, you can find logs within a specific timestamp range or filter logs by log level to focus on potential issues.</p>
<p>After parsing, you can use the structured fields to further organize your logs by configuring a reroute processor to send specific logs to different target data streams.</p>
<p>Refer to the following sections for more on parsing and organizing your log data:</p>
<ul class="simple">
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="extract-structured-fields">Extract structured fields</DocLink>: Extract structured fields like timestamps, log levels, or IP addresses to make querying and filtering your data easier.</p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="reroute-log-data-to-specific-data-streams">Reroute log data to specific data streams</DocLink>: Route data from the generic data stream to a target data stream for more granular control over data retention, permissions, and processing.</p></li>
</ul>
<section id="extract-structured-fields">
<h2>Extract structured fields<a class="headerlink" href="#extract-structured-fields" title="Link to this heading">¶</a></h2>
<p>Make your logs more useful by extracting structured fields from your unstructured log data. Extracting structured fields makes it easier to search, analyze, and filter your log data.</p>
<p>Follow the steps below to see how the following unstructured log data is indexed by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">12.123</span><span class="n">Z</span> <span class="n">WARN</span> <span class="mf">192.168.1.101</span> <span class="n">Disk</span> <span class="n">usage</span> <span class="n">exceeds</span> <span class="mi">90</span><span class="o">%.</span>
</pre></div>
</div>
<p>Start by storing the document in the <code class="docutils literal notranslate"><span class="pre">logs-example-default</span></code> data stream:</p>
<ol class="arabic">
<li><p>In your Observability project, go to <strong>Developer Tools</strong>.</p></li>
<li><p>In the <strong>Console</strong> tab, add the example log to your project using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST logs-example-default/_doc</span>
<span class="go">{</span>
<span class="go">&quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
</li>
<li><p>Then, you can retrieve the document with the following search:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET /logs-example-default/_search</span>
</pre></div>
</div>
</li>
</ol>
<p>The results should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.09-000001&quot;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-09T17:19:27.73312243Z&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Your project indexes the <code class="docutils literal notranslate"><span class="pre">message</span></code> field by default and adds a <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field. Since there was no timestamp set, it’s set to <code class="docutils literal notranslate"><span class="pre">now</span></code>.
At this point, you can search for phrases in the <code class="docutils literal notranslate"><span class="pre">message</span></code> field like <code class="docutils literal notranslate"><span class="pre">WARN</span></code> or <code class="docutils literal notranslate"><span class="pre">Disk</span> <span class="pre">usage</span> <span class="pre">exceeds</span></code>.
For example, run the following command to search for the phrase <code class="docutils literal notranslate"><span class="pre">WARN</span></code> in the log’s <code class="docutils literal notranslate"><span class="pre">message</span></code> field:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET logs-example-default/_search</span>
<span class="go">{</span>
<span class="go">  &quot;query&quot;: {</span>
<span class="go">    &quot;match&quot;: {</span>
<span class="go">      &quot;message&quot;: {</span>
<span class="go">        &quot;query&quot;: &quot;WARN&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>While you can search for phrases in the <code class="docutils literal notranslate"><span class="pre">message</span></code> field, you can’t use this field to filter log data. Your message, however, contains all of the following potential fields you can extract and use to filter and aggregate your log data:</p>
<ul class="simple">
<li><p><strong>&#64;timestamp</strong> (<code class="docutils literal notranslate"><span class="pre">2023-08-08T13:45:12.123Z</span></code>): Extracting this field lets you sort logs by date and time. This is helpful when you want to view your logs in the order that they occurred or identify when issues happened.</p></li>
<li><p><strong>log.level</strong> (<code class="docutils literal notranslate"><span class="pre">WARN</span></code>): Extracting this field lets you filter logs by severity. This is helpful if you want to focus on high-severity WARN or ERROR-level logs, and reduce noise by filtering out low-severity INFO-level logs.</p></li>
<li><p><strong>host.ip</strong> (<code class="docutils literal notranslate"><span class="pre">192.168.1.101</span></code>): Extracting this field lets you filter logs by the host IP addresses. This is helpful if you want to focus on specific hosts that you’re having issues with or if you want to find disparities between hosts.</p></li>
<li><p><strong>message</strong> (<code class="docutils literal notranslate"><span class="pre">Disk</span> <span class="pre">usage</span> <span class="pre">exceeds</span> <span class="pre">90%.</span></code>): You can search for phrases or words in the message field.</p></li>
</ul>
<DocCallOut title="Note">
These fields are part of the [Elastic Common Schema (ECS)](http://example.co)/ecs-reference.html). The ECS defines a common set of fields that you can use across your project when storing data, including log and metric data.
</DocCallOut>
<section id="extract-the-timestamp-field">
<h3>Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field<a class="headerlink" href="#extract-the-timestamp-field" title="Link to this heading">¶</a></h3>
<p>When you added the log to your project in the previous section, the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field showed when the log was added. The timestamp showing when the log actually occurred was in the unstructured <code class="docutils literal notranslate"><span class="pre">message</span></code> field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="o">...</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span><span class="p">,</span> \<span class="p">[</span>\<span class="o">^</span>\<span class="mi">1</span><span class="p">]</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-09T17:19:27.73312243Z&quot;</span> \<span class="p">[</span>\<span class="o">^</span>\<span class="mi">2</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>[^\1]: The timestamp in the <code class="docutils literal notranslate"><span class="pre">message</span></code> field shows when the log occurred.
[^\2]: The timestamp in the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field shows when the log was added to your project.</p>
<p>When looking into issues, you want to filter for logs by when the issue occurred not when the log was added to your project.
To do this, extract the timestamp from the unstructured <code class="docutils literal notranslate"><span class="pre">message</span></code> field to the structured <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field by completing the following:</p>
<ol class="arabic simple">
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="use-an-ingest-pipeline-to-extract-the-timestamp-field">Use an ingest pipeline to extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="test-the-pipeline-with-the-simulate-pipeline-api">Test the pipeline with the simulate pipeline API</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="configure-a-data-stream-with-an-index-template">Configure a data stream with an index template</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="create-a-data-stream">Create a data stream</DocLink></p></li>
</ol>
<section id="use-an-ingest-pipeline-to-extract-the-timestamp-field">
<h4>Use an ingest pipeline to extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field<a class="headerlink" href="#use-an-ingest-pipeline-to-extract-the-timestamp-field" title="Link to this heading">¶</a></h4>
<p>Ingest pipelines consist of a series of processors that perform common transformations on incoming documents before they are indexed.
To extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field from the example log, use an ingest pipeline with a <a class="reference external" href="http://example.co">dissect processor</a>/dissect-processor.html).
The dissect processor extracts structured fields from unstructured log messages based on a pattern you set.</p>
<p>Your project can parse string timestamps that are in <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd'T'HH:mm:ss.SSSZ</span></code> and <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span></code> formats into date fields.
Since the log example’s timestamp is in one of these formats, you don’t need additional processors.
More complex or nonstandard timestamps require a <a class="reference external" href="http://example.co">date processor</a>/date-processor.html) to parse the timestamp into a date field.</p>
<p>Use the following command to extract the timestamp from the <code class="docutils literal notranslate"><span class="pre">message</span></code> field into the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PUT _ingest/pipeline/logs-example-default</span>
<span class="go">{</span>
<span class="go">  &quot;description&quot;: &quot;Extracts the timestamp&quot;,</span>
<span class="go">  &quot;processors&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;dissect&quot;: {</span>
<span class="go">        &quot;field&quot;: &quot;message&quot;,</span>
<span class="go">        &quot;pattern&quot;: &quot;%{@timestamp} %{message}&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The previous command sets the following values for your ingest pipeline:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_ingest/pipeline/logs-example-default</span></code>: The name of the pipeline,<code class="docutils literal notranslate"><span class="pre">logs-example-default</span></code>, needs to match the name of your data stream. You’ll set up your data stream in the next section. For more information, refer to the <a class="reference external" href="http://example.co">data stream naming scheme</a>/data-streams.html#data-streams-naming-scheme).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field</span></code>: The field you’re extracting data from, <code class="docutils literal notranslate"><span class="pre">message</span></code> in this case.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code>: The pattern of the elements in your log data. The <code class="docutils literal notranslate"><span class="pre">%{&#64;timestamp}</span> <span class="pre">%{message}</span></code> pattern extracts the timestamp, <code class="docutils literal notranslate"><span class="pre">2023-08-08T13:45:12.123Z</span></code>, to the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field, while the rest of the message, <code class="docutils literal notranslate"><span class="pre">WARN</span> <span class="pre">192.168.1.101</span> <span class="pre">Disk</span> <span class="pre">usage</span> <span class="pre">exceeds</span> <span class="pre">90%.</span></code>, stays in the <code class="docutils literal notranslate"><span class="pre">message</span></code> field. The dissect processor looks for the space as a separator defined by the pattern.</p></li>
</ul>
</section>
<section id="test-the-pipeline-with-the-simulate-pipeline-api">
<h4>Test the pipeline with the simulate pipeline API<a class="headerlink" href="#test-the-pipeline-with-the-simulate-pipeline-api" title="Link to this heading">¶</a></h4>
<p>The <a class="reference external" href="http://example.co">simulate pipeline API</a>/simulate-pipeline-api.html#ingest-verbose-param) runs the ingest pipeline without storing any documents.
This lets you verify your pipeline works using multiple documents.</p>
<p>Run the following command to test your ingest pipeline with the simulate pipeline API.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST _ingest/pipeline/logs-example-default/_simulate</span>
<span class="go">{</span>
<span class="go">  &quot;docs&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;_source&quot;: {</span>
<span class="go">        &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The results should show the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field extracted from the <code class="docutils literal notranslate"><span class="pre">message</span></code> field:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{</span>
<span class="go">  &quot;docs&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;doc&quot;: {</span>
<span class="go">        &quot;_index&quot;: &quot;_index&quot;,</span>
<span class="go">        &quot;_id&quot;: &quot;_id&quot;,</span>
<span class="go">        &quot;_version&quot;: &quot;-3&quot;,</span>
<span class="go">        &quot;_source&quot;: {</span>
<span class="go">          &quot;message&quot;: &quot;WARN 192.168.1.101 Disk usage exceeds 90%.&quot;,</span>
<span class="go">          &quot;@timestamp&quot;: &quot;2023-08-08T13:45:12.123Z&quot;</span>
<span class="go">        },</span>
<span class="go">        ...</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<DocCallOut title="Note">
Make sure you've created the ingest pipeline using the `PUT` command in the previous section before using the simulate pipeline API.
</DocCallOut>
</section>
<section id="configure-a-data-stream-with-an-index-template">
<h4>Configure a data stream with an index template<a class="headerlink" href="#configure-a-data-stream-with-an-index-template" title="Link to this heading">¶</a></h4>
<p>After creating your ingest pipeline, run the following command to create an index template to configure your data stream’s backing indices:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PUT _index_template/logs-example-default-template</span>
<span class="go">{</span>
<span class="go">  &quot;index_patterns&quot;: [ &quot;logs-example-*&quot; ],</span>
<span class="go">  &quot;data_stream&quot;: { },</span>
<span class="go">  &quot;priority&quot;: 500,</span>
<span class="go">  &quot;template&quot;: {</span>
<span class="go">    &quot;settings&quot;: {</span>
<span class="go">      &quot;index.default_pipeline&quot;:&quot;logs-example-default&quot;</span>
<span class="go">    }</span>
<span class="go">  },</span>
<span class="go">  &quot;composed_of&quot;: [</span>
<span class="go">    &quot;logs@mappings&quot;,</span>
<span class="go">    &quot;logs@settings&quot;,</span>
<span class="go">    &quot;logs@custom&quot;,</span>
<span class="go">    &quot;ecs@mappings&quot;</span>
<span class="go">  ],</span>
<span class="go">  &quot;ignore_missing_component_templates&quot;: [&quot;logs@custom&quot;]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The previous command sets the following values for your index template:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">index_pattern</span></code>: Needs to match your log data stream. Naming conventions for data streams are <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;-&lt;dataset&gt;-&lt;namespace&gt;</span></code>. In this example, your logs data stream is named <code class="docutils literal notranslate"><span class="pre">logs-example-*</span></code>. Data that matches this pattern will go through your pipeline.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_stream</span></code>: Enables data streams.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code>: Sets the priority of your index templates. Index templates with a higher priority take precedence. If a data stream matches multiple index templates, your project uses the template with the higher priority. Built-in templates have a priority of <code class="docutils literal notranslate"><span class="pre">200</span></code>, so use a priority higher than <code class="docutils literal notranslate"><span class="pre">200</span></code> for custom templates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index.default_pipeline</span></code>: The name of your ingest pipeline. <code class="docutils literal notranslate"><span class="pre">logs-example-default</span></code> in this case.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">composed_of</span></code>: Here you can set component templates. Component templates are building blocks for constructing index templates that specify index mappings, settings, and aliases. Elastic has several built-in templates to help when ingesting your log data.</p></li>
</ul>
<p>The example index template above sets the following component templates:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">logs&#64;mappings</span></code>: general mappings for log data streams that include disabling automatic date detection from <code class="docutils literal notranslate"><span class="pre">string</span></code> fields and specifying mappings for <a class="reference external" href="http://example.co"><code class="docutils literal notranslate"><span class="pre">data_stream</span></code> ECS fields</a>/ecs-data_stream.html).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logs&#64;settings</span></code>: general settings for log data streams including the following:</p>
<ul>
<li><p>The default lifecycle policy that rolls over when the primary shard reaches 50 GB or after 30 days.</p></li>
<li><p>The default pipeline uses the ingest timestamp if there is no specified <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> and places a hook for the <code class="docutils literal notranslate"><span class="pre">logs&#64;custom</span></code> pipeline. If a <code class="docutils literal notranslate"><span class="pre">logs&#64;custom</span></code> pipeline is installed, it’s applied to logs ingested into this data stream.</p></li>
<li><p>Sets the <a class="reference external" href="http://example.co"><code class="docutils literal notranslate"><span class="pre">ignore_malformed</span></code></a>/ignore-malformed.html) flag to <code class="docutils literal notranslate"><span class="pre">true</span></code>. When ingesting a large batch of log data, a single malformed field like an IP address can cause the entire batch to fail. When set to true, malformed fields with a mapping type that supports this flag are still processed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logs&#64;custom</span></code>: a predefined component template that is not installed by default. Use this name to install a custom component template to override or extend any of the default mappings or settings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ecs&#64;mappings</span></code>: dynamic templates that automatically ensure your data stream mappings comply with the <a class="reference external" href="http://example.co">Elastic Common Schema (ECS)</a>/ecs-reference.html).</p></li>
</ul>
</li>
</ul>
</section>
<section id="create-a-data-stream">
<h4>Create a data stream<a class="headerlink" href="#create-a-data-stream" title="Link to this heading">¶</a></h4>
<p>Create your data stream using the <a class="reference external" href="http://example.co">data stream naming scheme</a>/data-streams.html#data-streams-naming-scheme). Name your data stream to match the name of your ingest pipeline, <code class="docutils literal notranslate"><span class="pre">logs-example-default</span></code> in this case. Post the example log to your data stream with this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST logs-example-default/_doc</span>
<span class="go">{</span>
<span class="go">  &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
<p>View your documents using this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET /logs-example-default/_search</span>
</pre></div>
</div>
<p>You should see the pipeline has extracted the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="p">{</span>
    <span class="o">...</span>
    <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="o">...</span>
      <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.09-000001&quot;</span><span class="p">,</span>
          <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;RsWy3IkB8yCtA5VGOKLf&quot;</span><span class="p">,</span>
          <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z&quot;</span> \<span class="p">[</span>\<span class="o">^</span>\<span class="mi">1</span><span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>[^\1]: The extracted <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field.</p>
<p>You can now use the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field to sort your logs by the date and time they happened.</p>
</section>
<section id="troubleshoot-the-timestamp-field">
<h4>Troubleshoot the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field<a class="headerlink" href="#troubleshoot-the-timestamp-field" title="Link to this heading">¶</a></h4>
<p>Check the following common issues and solutions with timestamps:</p>
<ul class="simple">
<li><p><strong>Timestamp failure:</strong> If your data has inconsistent date formats, set <code class="docutils literal notranslate"><span class="pre">ignore_failure</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> for your date processor. This processes logs with correctly formatted dates and ignores those with issues.</p></li>
<li><p><strong>Incorrect timezone:</strong> Set your timezone using the <code class="docutils literal notranslate"><span class="pre">timezone</span></code> option on the <a class="reference external" href="http://example.co">date processor</a>/date-processor.html).</p></li>
<li><p><strong>Incorrect timestamp format:</strong> Your timestamp can be a Java time pattern or one of the following formats: ISO8601, UNIX, UNIX_MS, or TAI64N. For more information on timestamp formats, refer to the <a class="reference external" href="http://example.co">mapping date format</a>/mapping-date-format.html).</p></li>
</ul>
</section>
</section>
<section id="extract-the-log-level-field">
<h3>Extract the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field<a class="headerlink" href="#extract-the-log-level-field" title="Link to this heading">¶</a></h3>
<p>Extracting the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field lets you filter by severity and focus on critical issues. This section shows you how to extract the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field from this example log:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">12.123</span><span class="n">Z</span> <span class="n">WARN</span> <span class="mf">192.168.1.101</span> <span class="n">Disk</span> <span class="n">usage</span> <span class="n">exceeds</span> <span class="mi">90</span><span class="o">%.</span>
</pre></div>
</div>
<p>To extract and use the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field:</p>
<ol class="arabic simple">
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="add-loglevel-to-your-ingest-pipeline">Add the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field to the dissect processor pattern in your ingest pipeline.</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="test-the-pipeline-with-the-simulate-api">Test the pipeline with the simulate API.</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="query-logs-based-on-loglevel">Query your logs based on the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field.</DocLink></p></li>
</ol>
<section id="add-log-level-to-your-ingest-pipeline">
<h4>Add <code class="docutils literal notranslate"><span class="pre">log.level</span></code> to your ingest pipeline<a class="headerlink" href="#add-log-level-to-your-ingest-pipeline" title="Link to this heading">¶</a></h4>
<p>Add the <code class="docutils literal notranslate"><span class="pre">%{log.level}</span></code> option to the dissect processor pattern in the ingest pipeline you created in the <DocLink slug="/serverless/observability/parse-log-data" section="use-an-ingest-pipeline-to-extract-the-timestamp-field">Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</DocLink> section with this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PUT _ingest/pipeline/logs-example-default</span>
<span class="go">{</span>
<span class="go">  &quot;description&quot;: &quot;Extracts the timestamp and log level&quot;,</span>
<span class="go">  &quot;processors&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;dissect&quot;: {</span>
<span class="go">        &quot;field&quot;: &quot;message&quot;,</span>
<span class="go">        &quot;pattern&quot;: &quot;%{@timestamp} %{log.level} %{message}&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Now your pipeline will extract these fields:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field: <code class="docutils literal notranslate"><span class="pre">2023-08-08T13:45:12.123Z</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field: <code class="docutils literal notranslate"><span class="pre">WARN</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">message</span></code> field: <code class="docutils literal notranslate"><span class="pre">192.168.1.101</span> <span class="pre">Disk</span> <span class="pre">usage</span> <span class="pre">exceeds</span> <span class="pre">90%.</span></code></p></li>
</ul>
<p>In addition to setting an ingest pipeline, you need to set an index template. Use the index template created in the <DocLink slug="/serverless/observability/parse-log-data" section="configure-a-data-stream-with-an-index-template">Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</DocLink> section.</p>
</section>
<section id="test-the-pipeline-with-the-simulate-api">
<h4>Test the pipeline with the simulate API<a class="headerlink" href="#test-the-pipeline-with-the-simulate-api" title="Link to this heading">¶</a></h4>
<p>Test that your ingest pipeline works as expected with the <a class="reference external" href="http://example.co">simulate pipeline API</a>/simulate-pipeline-api.html#ingest-verbose-param):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST _ingest/pipeline/logs-example-default/_simulate</span>
<span class="go">{</span>
<span class="go">  &quot;docs&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;_source&quot;: {</span>
<span class="go">        &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The results should show the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> and the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> fields extracted from the <code class="docutils literal notranslate"><span class="pre">message</span></code> field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_version&quot;</span><span class="p">:</span> <span class="s2">&quot;-3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.101 Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-8-08T13:45:12.123Z&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="o">...</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="query-logs-based-on-log-level">
<h4>Query logs based on <code class="docutils literal notranslate"><span class="pre">log.level</span></code><a class="headerlink" href="#query-logs-based-on-log-level" title="Link to this heading">¶</a></h4>
<p>Once you’ve extracted the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field, you can query for high-severity logs like <code class="docutils literal notranslate"><span class="pre">WARN</span></code> and <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, which may need immediate attention, and filter out less critical <code class="docutils literal notranslate"><span class="pre">INFO</span></code> and <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> logs.</p>
<p>Let’s say you have the following logs with varying severities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">12.123</span><span class="n">Z</span> <span class="n">WARN</span> <span class="mf">192.168.1.101</span> <span class="n">Disk</span> <span class="n">usage</span> <span class="n">exceeds</span> <span class="mi">90</span><span class="o">%.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">14.003</span><span class="n">Z</span> <span class="n">ERROR</span> <span class="mf">192.168.1.103</span> <span class="n">Database</span> <span class="n">connection</span> <span class="n">failed</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">15.004</span><span class="n">Z</span> <span class="n">DEBUG</span> <span class="mf">192.168.1.104</span> <span class="n">Debugging</span> <span class="n">connection</span> <span class="n">issue</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">16.005</span><span class="n">Z</span> <span class="n">INFO</span> <span class="mf">192.168.1.102</span> <span class="n">User</span> <span class="n">changed</span> <span class="n">profile</span> <span class="n">picture</span><span class="o">.</span>
</pre></div>
</div>
<p>Add them to your data stream using this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST logs-example-default/_bulk</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:14.003Z ERROR 192.168.1.103 Database connection failed.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:15.004Z DEBUG 192.168.1.104 Debugging connection issue.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:16.005Z INFO 192.168.1.102 User changed profile picture.&quot; }</span>
</pre></div>
</div>
<p>Then, query for documents with a log level of <code class="docutils literal notranslate"><span class="pre">WARN</span></code> or <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> with this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET logs-example-default/_search</span>
<span class="go">{</span>
<span class="go">  &quot;query&quot;: {</span>
<span class="go">    &quot;terms&quot;: {</span>
<span class="go">      &quot;log.level&quot;: [&quot;WARN&quot;, &quot;ERROR&quot;]</span>
<span class="go">    }</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The results should show only the high-severity logs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="o">...</span>
  <span class="p">},</span>
  <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="o">...</span>
    <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.14-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;3TcZ-4kB3FafvEVY4yKx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.101 Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z&quot;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.14-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;3jcZ-4kB3FafvEVY4yKx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.103 Database connection failed.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:14.003Z&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="extract-the-host-ip-field">
<h3>Extract the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field<a class="headerlink" href="#extract-the-host-ip-field" title="Link to this heading">¶</a></h3>
<p>Extracting the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field lets you filter logs by host IP addresses allowing you to focus on specific hosts that you’re having issues with or find disparities between hosts.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field is part of the <a class="reference external" href="http://example.co">Elastic Common Schema (ECS)</a>/ecs-reference.html). Through the ECS, the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field is mapped as an <a class="reference external" href="http://example.co"><code class="docutils literal notranslate"><span class="pre">ip</span></code> field type</a>/ip.html). <code class="docutils literal notranslate"><span class="pre">ip</span></code> field types allow range queries so you can find logs with IP addresses in a specific range. You can also query <code class="docutils literal notranslate"><span class="pre">ip</span></code> field types using Classless Inter-Domain Routing (CIDR) notation to find logs from a particular network or subnet.</p>
<p>This section shows you how to extract the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field from the following example logs and query based on the extracted fields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">12.123</span><span class="n">Z</span> <span class="n">WARN</span> <span class="mf">192.168.1.101</span> <span class="n">Disk</span> <span class="n">usage</span> <span class="n">exceeds</span> <span class="mi">90</span><span class="o">%.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">14.003</span><span class="n">Z</span> <span class="n">ERROR</span> <span class="mf">192.168.1.103</span> <span class="n">Database</span> <span class="n">connection</span> <span class="n">failed</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">15.004</span><span class="n">Z</span> <span class="n">DEBUG</span> <span class="mf">192.168.1.104</span> <span class="n">Debugging</span> <span class="n">connection</span> <span class="n">issue</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">16.005</span><span class="n">Z</span> <span class="n">INFO</span> <span class="mf">192.168.1.102</span> <span class="n">User</span> <span class="n">changed</span> <span class="n">profile</span> <span class="n">picture</span><span class="o">.</span>
</pre></div>
</div>
<p>To extract and use the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field:</p>
<ol class="arabic simple">
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="add-hostip-to-your-ingest-pipeline">Add the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field to your dissect processor in your ingest pipeline.</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="test-the-pipeline-with-the-simulate-api">Test the pipeline with the simulate API.</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="query-logs-based-on-hostip">Query your logs based on the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field.</DocLink></p></li>
</ol>
<section id="add-host-ip-to-your-ingest-pipeline">
<h4>Add <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> to your ingest pipeline<a class="headerlink" href="#add-host-ip-to-your-ingest-pipeline" title="Link to this heading">¶</a></h4>
<p>Add the <code class="docutils literal notranslate"><span class="pre">%{host.ip}</span></code> option to the dissect processor pattern in the ingest pipeline you created in the <DocLink slug="/serverless/observability/parse-log-data" section="use-an-ingest-pipeline-to-extract-the-timestamp-field">Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</DocLink> section:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PUT _ingest/pipeline/logs-example-default</span>
<span class="go">{</span>
<span class="go">  &quot;description&quot;: &quot;Extracts the timestamp log level and host ip&quot;,</span>
<span class="go">  &quot;processors&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;dissect&quot;: {</span>
<span class="go">        &quot;field&quot;: &quot;message&quot;,</span>
<span class="go">        &quot;pattern&quot;: &quot;%{@timestamp} %{log.level} %{host.ip} %{message}&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Your pipeline will extract these fields:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field: <code class="docutils literal notranslate"><span class="pre">2023-08-08T13:45:12.123Z</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field: <code class="docutils literal notranslate"><span class="pre">WARN</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field: <code class="docutils literal notranslate"><span class="pre">192.168.1.101</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">message</span></code> field: <code class="docutils literal notranslate"><span class="pre">Disk</span> <span class="pre">usage</span> <span class="pre">exceeds</span> <span class="pre">90%.</span></code></p></li>
</ul>
<p>In addition to setting an ingest pipeline, you need to set an index template. Use the index template created in the <DocLink slug="/serverless/observability/parse-log-data" section="configure-a-data-stream-with-an-index-template">Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</DocLink> section.</p>
</section>
<section id="id1">
<h4>Test the pipeline with the simulate API<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<p>Test that your ingest pipeline works as expected with the <a class="reference external" href="http://example.co">simulate pipeline API</a>/simulate-pipeline-api.html#ingest-verbose-param):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST _ingest/pipeline/logs-example-default/_simulate</span>
<span class="go">{</span>
<span class="go">  &quot;docs&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;_source&quot;: {</span>
<span class="go">        &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The results should show the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code>, and <code class="docutils literal notranslate"><span class="pre">log.level</span></code> fields extracted from the <code class="docutils literal notranslate"><span class="pre">message</span></code> field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.101&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="o">...</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="query-logs-based-on-host-ip">
<h4>Query logs based on <code class="docutils literal notranslate"><span class="pre">host.ip</span></code><a class="headerlink" href="#query-logs-based-on-host-ip" title="Link to this heading">¶</a></h4>
<p>You can query your logs based on the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field in different ways, including using CIDR notation and range queries.</p>
<p>Before querying your logs, add them to your data stream using this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST logs-example-default/_bulk</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:14.003Z ERROR 192.168.1.103 Database connection failed.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:15.004Z DEBUG 192.168.1.104 Debugging connection issue.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:16.005Z INFO 192.168.1.102 User changed profile picture.&quot; }</span>
</pre></div>
</div>
<section id="cidr-notation">
<h5>CIDR notation<a class="headerlink" href="#cidr-notation" title="Link to this heading">¶</a></h5>
<p>You can use <a class="reference external" href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation">CIDR notation</a> to query your log data using a block of IP addresses that fall within a certain network segment. CIDR notations uses the format of <code class="docutils literal notranslate"><span class="pre">[IP</span> <span class="pre">address]/[prefix</span> <span class="pre">length]</span></code>. The following command queries IP addresses in the <code class="docutils literal notranslate"><span class="pre">192.168.1.0/24</span></code> subnet meaning IP addresses from <code class="docutils literal notranslate"><span class="pre">192.168.1.0</span></code> to <code class="docutils literal notranslate"><span class="pre">192.168.1.255</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET logs-example-default/_search</span>
<span class="go">{</span>
<span class="go">  &quot;query&quot;: {</span>
<span class="go">    &quot;term&quot;: {</span>
<span class="go">      &quot;host.ip&quot;: &quot;192.168.1.0/24&quot;</span>
<span class="go">    }</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Because all of the example logs are in this range, you’ll get the following results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="p">},</span>
  <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.16-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ak4oAIoBl7fe5ItIixuB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.101&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.16-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;a04oAIoBl7fe5ItIixuC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.103&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:14.003Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Database connection failed.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.16-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;bE4oAIoBl7fe5ItIixuC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.104&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:15.004Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Debugging connection issue.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.16-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;bU4oAIoBl7fe5ItIixuC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.102&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:16.005Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;User changed profile picture.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="range-queries">
<h5>Range queries<a class="headerlink" href="#range-queries" title="Link to this heading">¶</a></h5>
<p>Use <a class="reference external" href="http://example.co">range queries</a>/query-dsl-range-query.html) to query logs in a specific range.</p>
<p>The following command searches for IP addresses greater than or equal to <code class="docutils literal notranslate"><span class="pre">192.168.1.100</span></code> and less than or equal to <code class="docutils literal notranslate"><span class="pre">192.168.1.102</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET logs-example-default/_search</span>
<span class="go">{</span>
<span class="go">  &quot;query&quot;: {</span>
<span class="go">    &quot;range&quot;: {</span>
<span class="go">      &quot;host.ip&quot;: {</span>
<span class="go">        &quot;gte&quot;: &quot;192.168.1.100&quot;, \[\^\1]</span>
<span class="go">        &quot;lte&quot;: &quot;192.168.1.102&quot; \[\^\2]</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>[^\1]: Greater than or equal to <code class="docutils literal notranslate"><span class="pre">192.168.1.100</span></code>.
[^\2]: Less than or equal to <code class="docutils literal notranslate"><span class="pre">192.168.1.102</span></code>.</p>
<p>You’ll get the following results only showing logs in the range you’ve set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="p">},</span>
  <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.16-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ak4oAIoBl7fe5ItIixuB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.101&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;.ds-logs-example-default-2023.08.16-000001&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;bU4oAIoBl7fe5ItIixuC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.102&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:16.005Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;User changed profile picture.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;INFO&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="reroute-log-data-to-specific-data-streams">
<h2>Reroute log data to specific data streams<a class="headerlink" href="#reroute-log-data-to-specific-data-streams" title="Link to this heading">¶</a></h2>
<p>By default, an ingest pipeline sends your log data to a single data stream. To simplify log data management, use a <a class="reference external" href="http://example.co">reroute processor</a>/reroute-processor.html) to route data from the generic data stream to a target data stream. For example, you might want to send high-severity logs to a specific data stream to help with categorization.</p>
<p>This section shows you how to use a reroute processor to send the high-severity logs (<code class="docutils literal notranslate"><span class="pre">WARN</span></code> or <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>) from the following example logs to a specific data stream and keep the regular logs (<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> and <code class="docutils literal notranslate"><span class="pre">INFO</span></code>) in the default data stream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">12.123</span><span class="n">Z</span> <span class="n">WARN</span> <span class="mf">192.168.1.101</span> <span class="n">Disk</span> <span class="n">usage</span> <span class="n">exceeds</span> <span class="mi">90</span><span class="o">%.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">14.003</span><span class="n">Z</span> <span class="n">ERROR</span> <span class="mf">192.168.1.103</span> <span class="n">Database</span> <span class="n">connection</span> <span class="n">failed</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">15.004</span><span class="n">Z</span> <span class="n">DEBUG</span> <span class="mf">192.168.1.104</span> <span class="n">Debugging</span> <span class="n">connection</span> <span class="n">issue</span><span class="o">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span><span class="n">T13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">16.005</span><span class="n">Z</span> <span class="n">INFO</span> <span class="mf">192.168.1.102</span> <span class="n">User</span> <span class="n">changed</span> <span class="n">profile</span> <span class="n">picture</span><span class="o">.</span>
</pre></div>
</div>
<DocCallOut title="Note">
When routing data to different data streams, we recommend picking a field with a limited number of distinct values to prevent an excessive increase in the number of data streams. For more details, refer to the [Size your shards](http://example.co)/size-your-shards.html) documentation.
</DocCallOut>
<p>To use a reroute processor:</p>
<ol class="arabic simple">
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="add-a-reroute-processor-to-the-ingest-pipeline">Add a reroute processor to your ingest pipeline.</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="add-logs-to-a-data-stream">Add the example logs to your data stream.</DocLink></p></li>
<li><p><DocLink slug="/serverless/observability/parse-log-data" section="verify-the-reroute-processor-worked">Query your logs and verify the high-severity logs were routed to the new data stream.</DocLink></p></li>
</ol>
<section id="add-a-reroute-processor-to-the-ingest-pipeline">
<h3>Add a reroute processor to the ingest pipeline<a class="headerlink" href="#add-a-reroute-processor-to-the-ingest-pipeline" title="Link to this heading">¶</a></h3>
<p>Add a reroute processor to your ingest pipeline with the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PUT _ingest/pipeline/logs-example-default</span>
<span class="go">{</span>
<span class="go">  &quot;description&quot;: &quot;Extracts fields and reroutes WARN&quot;,</span>
<span class="go">  &quot;processors&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;dissect&quot;: {</span>
<span class="go">        &quot;field&quot;: &quot;message&quot;,</span>
<span class="go">        &quot;pattern&quot;: &quot;%{@timestamp} %{log.level} %{host.ip} %{message}&quot;</span>
<span class="go">      }</span>
<span class="go">    },</span>
<span class="go">    {</span>
<span class="go">      &quot;reroute&quot;: {</span>
<span class="go">        &quot;tag&quot;: &quot;high_severity_logs&quot;,</span>
<span class="go">        &quot;if&quot; : &quot;ctx.log?.level == &#39;WARN&#39; || ctx.log?.level == &#39;ERROR&#39;&quot;,</span>
<span class="go">        &quot;dataset&quot;: &quot;critical&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The previous command sets the following values for your reroute processor:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tag</span></code>: Identifier for the processor that you can use for debugging and metrics. In the example, the tag is set to <code class="docutils literal notranslate"><span class="pre">high_severity_logs</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if</span></code>: Conditionally runs the processor. In the example, <code class="docutils literal notranslate"><span class="pre">&quot;ctx.log?.level</span> <span class="pre">==</span> <span class="pre">'WARN'</span> <span class="pre">||</span> <span class="pre">ctx.log?.level</span> <span class="pre">==</span> <span class="pre">'ERROR'&quot;,</span></code> means the processor runs when the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field is <code class="docutils literal notranslate"><span class="pre">WARN</span></code> or <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dataset</span></code>: the data stream dataset to route your document to if the previous condition is <code class="docutils literal notranslate"><span class="pre">true</span></code>. In the example, logs with a <code class="docutils literal notranslate"><span class="pre">log.level</span></code> of <code class="docutils literal notranslate"><span class="pre">WARN</span></code> or <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> are routed to the <code class="docutils literal notranslate"><span class="pre">logs-critical-default</span></code> data stream.</p></li>
</ul>
<p>In addition to setting an ingest pipeline, you need to set an index template. Use the index template created in the <DocLink slug="/serverless/observability/parse-log-data" section="configure-a-data-stream-with-an-index-template">Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</DocLink> section.</p>
</section>
<section id="add-logs-to-a-data-stream">
<h3>Add logs to a data stream<a class="headerlink" href="#add-logs-to-a-data-stream" title="Link to this heading">¶</a></h3>
<p>Add the example logs to your data stream with this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">POST logs-example-default/_bulk</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:12.123Z WARN 192.168.1.101 Disk usage exceeds 90%.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:14.003Z ERROR 192.168.1.103 Database connection failed.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:15.004Z DEBUG 192.168.1.104 Debugging connection issue.&quot; }</span>
<span class="go">{ &quot;create&quot;: {} }</span>
<span class="go">{ &quot;message&quot;: &quot;2023-08-08T13:45:16.005Z INFO 192.168.1.102 User changed profile picture.&quot; }</span>
</pre></div>
</div>
</section>
<section id="verify-the-reroute-processor-worked">
<h3>Verify the reroute processor worked<a class="headerlink" href="#verify-the-reroute-processor-worked" title="Link to this heading">¶</a></h3>
<p>The reroute processor should route any logs with a <code class="docutils literal notranslate"><span class="pre">log.level</span></code> of <code class="docutils literal notranslate"><span class="pre">WARN</span></code> or <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> to the <code class="docutils literal notranslate"><span class="pre">logs-critical-default</span></code> data stream. Query the data stream using the following command to verify the log data was routed as intended:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET logs-critical-default/_search</span>
</pre></div>
</div>
<p>Your should see similar results to the following showing that the high-severity logs are now in the <code class="docutils literal notranslate"><span class="pre">critical</span></code> dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">...</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.101&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:12.123Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Disk usage exceeds 90%.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;data_stream&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
        <span class="o">...</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.103&quot;</span>
           <span class="p">},</span>
          <span class="s2">&quot;@timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-08-08T13:45:14.003Z&quot;</span><span class="p">,</span>
          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Database connection failed.&quot;</span><span class="p">,</span>
          <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;data_stream&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="filter-and-aggregate-logs.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Filter and aggregate logs</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="send-application-logs.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">PRODUCT_NAME log sending</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Elasticsearch B.V. All Rights Reserved.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Parse and route logs</a><ul>
<li><a class="reference internal" href="#extract-structured-fields">Extract structured fields</a><ul>
<li><a class="reference internal" href="#extract-the-timestamp-field">Extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</a><ul>
<li><a class="reference internal" href="#use-an-ingest-pipeline-to-extract-the-timestamp-field">Use an ingest pipeline to extract the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</a></li>
<li><a class="reference internal" href="#test-the-pipeline-with-the-simulate-pipeline-api">Test the pipeline with the simulate pipeline API</a></li>
<li><a class="reference internal" href="#configure-a-data-stream-with-an-index-template">Configure a data stream with an index template</a></li>
<li><a class="reference internal" href="#create-a-data-stream">Create a data stream</a></li>
<li><a class="reference internal" href="#troubleshoot-the-timestamp-field">Troubleshoot the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> field</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extract-the-log-level-field">Extract the <code class="docutils literal notranslate"><span class="pre">log.level</span></code> field</a><ul>
<li><a class="reference internal" href="#add-log-level-to-your-ingest-pipeline">Add <code class="docutils literal notranslate"><span class="pre">log.level</span></code> to your ingest pipeline</a></li>
<li><a class="reference internal" href="#test-the-pipeline-with-the-simulate-api">Test the pipeline with the simulate API</a></li>
<li><a class="reference internal" href="#query-logs-based-on-log-level">Query logs based on <code class="docutils literal notranslate"><span class="pre">log.level</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#extract-the-host-ip-field">Extract the <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> field</a><ul>
<li><a class="reference internal" href="#add-host-ip-to-your-ingest-pipeline">Add <code class="docutils literal notranslate"><span class="pre">host.ip</span></code> to your ingest pipeline</a></li>
<li><a class="reference internal" href="#id1">Test the pipeline with the simulate API</a></li>
<li><a class="reference internal" href="#query-logs-based-on-host-ip">Query logs based on <code class="docutils literal notranslate"><span class="pre">host.ip</span></code></a><ul>
<li><a class="reference internal" href="#cidr-notation">CIDR notation</a></li>
<li><a class="reference internal" href="#range-queries">Range queries</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#reroute-log-data-to-specific-data-streams">Reroute log data to specific data streams</a><ul>
<li><a class="reference internal" href="#add-a-reroute-processor-to-the-ingest-pipeline">Add a reroute processor to the ingest pipeline</a></li>
<li><a class="reference internal" href="#add-logs-to-a-data-stream">Add logs to a data stream</a></li>
<li><a class="reference internal" href="#verify-the-reroute-processor-worked">Verify the reroute processor worked</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=140f00c8"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>