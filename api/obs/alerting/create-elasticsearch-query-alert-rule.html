<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Create a custom threshold rule" href="create-custom-threshold-alert-rule.html" /><link rel="prev" title="Triage SLO burn rate breaches" href="triage-slo-burn-rate-breaches.html" />

    <!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06.dev1 -->
        <title>Create an Elasticsearch query rule - Elastic documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=4a3d756c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <!-- DESKTOP HEADER -->
  <header class="header">
    <a class="header__logo" href="#">CWK</a>
    <div class="header__toggle">
        <i class="bx bx-menu" id="header-toggle"></i>
    </div>
    <nav class="nav" id="nav-menu">
        <div class="nav__content bg-grid">
            <a class="nav__profil" href="#">
                <div class="nav__img">
                    <img src="https://codwerk.github.io/assets/images/logo_codwerk-new.png" alt="" />
                </div>
                <div>
                    <span class="nav__name">Elastic Docs</span>
                </div>
            </a>
            <div class="nav__menu">
                <ul class="nav__list">
                    <li class="nav__item"><a class="nav__link" href="#">Get Started</a></li>
                    <li class="nav__item dropdown">
                        <a class="nav__link dropdown__link" href="#">
                            Solutions<i class="bx bx-chevron-down dropdown__icon"></i>
                            <ul class="dropdown__menu">
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Search</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Security</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Observability</a>
                                </li>
                            </ul>
                        </a>
                    </li>
                    <li class="nav__item dropdown">
                      <a class="nav__link dropdown__link" href="#">
                          Platform
                          <i class="bx bx-chevron-down dropdown__icon"></i>
                          <ul class="dropdown__menu">
                              <li class="dropdown__item">
                                  <a class="nav__link" href="#">Elasticsearch</a>
                              </li>
                              <li class="dropdown__item">
                                  <a class="nav__link" href="#">Logstash</a>
                              </li>
                              <li class="dropdown__item">
                                  <a class="nav__link" href="#">Beats</a>
                              </li>
                          </ul>
                      </a>
                  </li>
                    <li class="nav__item dropdown">
                        <a class="nav__link dropdown__link" href="#">
                            API
                            <i class="bx bx-chevron-down dropdown__icon"></i>
                            <ul class="dropdown__menu">
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Elasticsearch</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Logstash</a>
                                </li>
                                <li class="dropdown__item">
                                    <a class="nav__link" href="#">Beats</a>
                                </li>
                            </ul>
                        </a>
                    </li>
                    <li class="nav__item">
                        <a class="nav__link" href="#">Release Docs</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

  <!-- MOBILE HEADER -->
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Elastic  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Elastic  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search me" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Observability</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Observability</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../observability-overview.html">Observability overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../elastic-entity-model.html">Elastic Entity Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/create-an-observability-project.html">Create an Elastic Observability project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/billing.html">Observability billing dimensions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apm/index.html">Application performance monitoring (APM)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Application performance monitoring (APM)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-distributed-tracing.html">Distributed tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-metrics.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-stacktrace-collection.html">Stacktrace collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-create-custom-links.html">Create custom links</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-data-types.html">APM data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-overview.html">Navigate the Applications UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-reference.html">Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-get-started.html">Get started with traces and APM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-kibana-settings.html">Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-logs.html">Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-transaction-sampling.html">Transaction sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-observe-lambda-functions.html">Observe Lambda functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-service-overview.html">Service Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-transactions.html">Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-track-deployments-with-annotations.html">Track deployments with annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-traces.html">Traces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/new-experience-services.html">New services experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-query-your-data.html">Query your data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-errors.html">Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-filter-your-data.html">Filter your data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-reduce-your-data-usage.html">Reduce your data usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-view-and-analyze-traces.html">View and analyze traces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-service-map.html">Service map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-services.html">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-integrate-with-machine-learning.html">Integrate with machine learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-problems.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-problems.html#no-data-is-indexed">No data is indexed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-response-codes.html">Troubleshooting two</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-troubleshooting/common-response-codes.html#http-400-data-decoding-error-data-validation-error">HTTP 400: Data decoding error / Data validation error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-send-traces-to-elastic.html">Send APM data to Elastic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-transaction-sampling/configure-head-based-sampling.html">tran sampl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-transaction-sampling/configure-head-based-sampling.html#id1">tran sampl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-compress-spans.html">Compress spans</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-find-transaction-latency-and-failure-correlations.html">Find transaction latency and failure correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-dependencies.html">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-trace-sample-timeline.html">Trace sample timeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-server-api.html">Managed intake service event API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-ui-infrastructure.html">Infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm/apm-keep-data-secure.html">Keep APM data secure</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../logging/index.html">Log monitoring</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Log monitoring</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../logging/get-started-with-logs.html">Get started with system logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/stream-log-files.html">Stream any log file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/correlate-application-logs.html">Stream application logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/plaintext-application-logs.html">Plaintext application logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/ecs-application-logs.html">ECS formatted application logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/send-application-logs.html">PRODUCT_NAME log sending</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/parse-log-data.html">Parse and route logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/filter-and-aggregate-logs.html">Filter and aggregate logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/view-and-monitor-logs.html">Explore logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/monitor-datasets.html">Monitor log data set quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/add-logs-service-name.html">Add a service name to logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/run-log-pattern-analysis.html">Run a pattern analysis on log data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/troubleshoot-logs.html">Troubleshoot logs</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../synthetics/index.html">Synthetics</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Synthetics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-lightweight.html">Configure lightweight monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-manage-monitors.html">Manage monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-get-started-ui.html">Create monitors in the Synthetics UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-scale-and-architect.html">Scale and architect a Synthetics deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-create-test.html">Write a synthetic test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-manage-retention.html">Manage data retention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-configuration.html">Configure a Synthetics project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-params-secrets.html">Work with params and secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-settings.html">Configure Synthetics settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-get-started-project.html">Create monitors with a Synthetics project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-command-reference.html">Use the Synthetics CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-intro.html">Synthetic monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-journeys.html">Scripting browser monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-private-location.html">Monitor resources on private networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html">Use the Synthetics Recorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#record-a-journey">Record a journey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#edit-a-journey">Edit a journey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#test-the-journey">Test the journey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-recorder.html#export">Export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-analyze.html">Analyze data from synthetic monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-troubleshooting.html">Troubleshooting Synthetics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-monitor-use.html">Configure individual browser monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-feature-roles.html">Grant users access to secured resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../synthetics/synthetics-security-encryption.html">Synthetics Encryption and Security</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Create and manage rules</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Create and manage rules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="create-slo-burn-rate-alert-rule.html">Create an SLO burn rate rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="triage-threshold-breaches.html">Triage threshold breaches</a></li>
<li class="toctree-l3"><a class="reference internal" href="view-alerts.html">View alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-inventory-threshold-alert-rule.html">Create an inventory rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="alerting.html">Alerting</a></li>
<li class="toctree-l3"><a class="reference internal" href="aiops-generate-anomaly-alerts.html">Create an anomaly detection rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-anomaly-alert-rule.html">Create an APM anomaly rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="aggregation-options.html">Aggregation options</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-latency-threshold-alert-rule.html">Create a latency threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="triage-slo-burn-rate-breaches.html">Triage SLO burn rate breaches</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Create an Elasticsearch query rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-custom-threshold-alert-rule.html">Create a custom threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="alerting-connectors.html">Alerting connectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-error-count-threshold-alert-rule.html">Create an error count threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="create-failed-transaction-rate-threshold-alert-rule.html">Create a failed transaction rate threshold rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="rate-aggregation.html">Rate aggregation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cases/index.html">Cases</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Cases</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cases/manage-cases-settings.html">Configure case settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cases/create-manage-cases.html">Create and manage cases</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../unsorted/index.html">Unsorted</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Unsorted</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-elastic-apm-agents.html">Elastic APM agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-collect-metrics.html">Collect metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-resource-attributes.html">Resource attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-opentelemetry-apisdk-with-elastic-apm-agents.html">OpenTelemetry API/SDK with Elastic APM agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-limitations.html">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-aws-lambda-functions.html">AWS Lambda functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry.html">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-opentelemetry-native-support.html">OpenTelemetry native support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apm-agents/apm-agents-opentelemetry-other-execution-environments.html">AWS Lambda support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-anomalies.html">Detect anomalies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-anomalies.html#create-and-run-an-anomaly-detection-job">Create and run an anomaly detection job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-anomalies.html#view-the-results">View the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-forecast-anomaly.html">Forecast future behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-tune-anomaly-detection-job.html">Tune your anomaly detection job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-detect-change-points.html">Detect change points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops-analyze-spikes.html">Analyze log spikes and drops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aiops/aiops.html">AIOps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dashboards/dashboards-and-visualizations.html">Dashboards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/metrics-app-fields.html">Required fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/get-started-with-metrics.html">Get started with system metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/metrics-reference.html">Metrics reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/analyze-hosts.html">Analyze and compare hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/detect-metric-anomalies.html">Detect metric anomalies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/kubernetes-pod-metrics.html">Kubernetes pod metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/configure-infra-settings.html">Configure settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/docker-container-metrics.html">Docker container metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/view-infrastructure-metrics.html">View infrastructure metrics by resource type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/host-metrics.html">Host metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/aws-metrics.html">AWS metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infra-monitoring/infra-monitoring.html">Infrastructure monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ai-assistant/ai-assistant.html">AI Assistant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slos/slos.html">SLOs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slos/create-an-slo.html">Create an SLO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../search/index.html">Elastic Search</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Elastic Search</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../search/bucket-1/index.html">Bucket 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../search/bucket-2/index.html">Bucket 2</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../sec/index.html">Elastic Security</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Elastic Security</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../sec/bucket-1/index.html">Bucket 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sec/bucket-2/index.html">Bucket 2</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/obs/alerting/create-elasticsearch-query-alert-rule.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="create-an-elasticsearch-query-rule">
<h1>Create an Elasticsearch query rule<a class="headerlink" href="#create-an-elasticsearch-query-rule" title="Link to this heading">¶</a></h1>
<p><DocBadge template="technical preview" /></p>
<p>import Connectors from ‘./alerting-connectors.mdx’</p>
<p>import Roles from ‘../partials/roles.mdx’</p>
<Roles role="Editor" goal="create Elasticsearch query rules" />
<div id="rule-type-es-query"></div>
<p>The PRODUCT_NAME query rule type runs a user-configured query, compares the number of
matches to a configured threshold, and schedules actions to run when the
threshold condition is met.</p>
<ol class="arabic simple">
<li><p>To access this page, from your project go to <strong>Alerts</strong>.</p></li>
<li><p>Click <strong>Manage Rules</strong> → <strong>Create rule</strong>.</p></li>
<li><p>Under <strong>Select rule type</strong>, select <strong>(PRODUCT_NAME) query</strong>.</p></li>
</ol>
<p>An PRODUCT_NAME query rule can be defined using PRODUCT_NAME Query Domain Specific Language (DSL), PRODUCT_NAME Query Language (ES|QL), PRODUCT_NAME Query Language (KQL), or Lucene.</p>
<section id="define-the-conditions">
<h2>Define the conditions<a class="headerlink" href="#define-the-conditions" title="Link to this heading">¶</a></h2>
<p>When you create an PRODUCT_NAME query rule, your choice of query type affects the information you must provide.
For example:</p>
<p><img alt="Define the condition to detect" src="../../_images/alerting-rule-types-es-query-conditions.png" /></p>
<!--  NOTE: This is an autogenerated screenshot. Do not edit it directly.-->
<ol class="arabic">
<li><p>Define your query</p>
<p>If you use <a class="reference external" href="http://example.co">query DSL</a>/query-dsl.html), you must select an index and time field then provide your query.
Only the <code class="docutils literal notranslate"><span class="pre">query</span></code>, <code class="docutils literal notranslate"><span class="pre">fields</span></code>, <code class="docutils literal notranslate"><span class="pre">_source</span></code> and <code class="docutils literal notranslate"><span class="pre">runtime_mappings</span></code> fields are used, other DSL fields are not considered.
For example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;query&quot;</span>:<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;match_all&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If you use <a class="reference external" href="http://example.co">KQL</a>/kuery-query.html) or <a class="reference external" href="http://example.co">Lucene</a>/lucene-query.html), you must specify a data view then define a text-based query.
For example, <code class="docutils literal notranslate"><span class="pre">http.request.referrer:</span> <span class="pre">&quot;https://http://example.com&quot;</span></code>.</p>
 <DocBadge template="technical preview" />
 If you use [ES|QL](http://example.co)/esql.html), you must provide a source command followed by an optional series of processing commands, separated by pipe characters (|).
 For example:
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>FROM<span class="w"> </span>kibana_sample_data_logs
<span class="p">|</span><span class="w"> </span>STATS<span class="w"> </span><span class="nv">total_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SUM<span class="o">(</span>bytes<span class="o">)</span><span class="w"> </span>BY<span class="w"> </span>host
<span class="p">|</span><span class="w"> </span>WHERE<span class="w"> </span>total_bytes<span class="w"> </span>&gt;<span class="w"> </span><span class="m">200000</span>
<span class="p">|</span><span class="w"> </span>SORT<span class="w"> </span>total_bytes<span class="w"> </span>DESC
<span class="p">|</span><span class="w"> </span>LIMIT<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
</li>
<li><p>If you use query DSL, KQL, or Lucene, set the group and theshold.</p>
<p>When
: Specify how to calculate the value that is compared to the threshold. The value is calculated by aggregating a numeric field within the time window. The aggregation options are: <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">average</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, and <code class="docutils literal notranslate"><span class="pre">max</span></code>. When using <code class="docutils literal notranslate"><span class="pre">count</span></code> the document count is used and an aggregation field is not necessary.
Over or Grouped Over
: Specify whether the aggregation is applied over all documents or split into groups using up to four grouping fields.
If you choose to use grouping, it’s a <a class="reference external" href="http://example.co">terms</a>/search-aggregations-bucket-terms-aggregation.html) or <a class="reference external" href="http://example.co">multi terms aggregation</a>/search-aggregations-bucket-multi-terms-aggregation.html); an alert will be created for each unique set of values when it meets the condition.
To limit the number of alerts on high cardinality fields, you must specify the number of groups to check against the threshold.
Only the top groups are checked.</p>
<p>Threshold
: Defines a threshold value and a comparison operator  (<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">above</span></code>,
<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">above</span> <span class="pre">or</span> <span class="pre">equals</span></code>, <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">below</span></code>, <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">below</span> <span class="pre">or</span> <span class="pre">equals</span></code>, or <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">between</span></code>). The value
calculated by the aggregation is compared to this threshold.</p>
</li>
<li><p>Set the time window, which defines how far back to search for documents.</p></li>
<li><p>If you use query DSL, KQL, or Lucene, set the number of documents to send to the configured actions when the threshold condition is met.</p></li>
<li><p>If you use query DSL, KQL, or Lucene, choose whether to avoid alert duplication by excluding matches from the previous run.
This option is not available when you use a grouping field.</p></li>
<li><p>Set the check interval, which defines how often to evaluate the rule conditions.
Generally this value should be set to a value that is smaller than the time window, to avoid gaps in
detection.</p></li>
</ol>
</section>
<section id="test-your-query">
<h2>Test your query<a class="headerlink" href="#test-your-query" title="Link to this heading">¶</a></h2>
<p>Use the <strong>Test query</strong> feature to verify that your query is valid.</p>
<p>If you use query DSL, KQL, or Lucene, the query runs against the selected indices using the configured time window.
The number of documents that match the query is displayed.
For example:</p>
<p><img alt="Test PRODUCT_NAME query returns number of matches when valid" src="../../_images/alerting-rule-types-es-query-valid.png" /></p>
<!--  NOTE: This is an autogenerated screenshot. Do not edit it directly.-->
<p><DocBadge template="technical preview" />  If you use an ES|QL query, a table is displayed. For example:</p>
<p><img alt="Test ES|QL query returns a table when valid" src="../../_images/alerting-rule-types-esql-query-valid.png" /></p>
<p>If the query is not valid, an error occurs.</p>
</section>
<section id="add-actions">
<h2>Add actions<a class="headerlink" href="#add-actions" title="Link to this heading">¶</a></h2>
<!-- TODO: Decide whether to use boiler plate text, or the text from the source docs for this rule.-->
<p>You can optionally send notifications when the rule conditions are met and when they are no longer met.
In particular, this rule type supports:</p>
<ul class="simple">
<li><p>alert summaries</p></li>
<li><p>actions that run when the query is matched</p></li>
<li><p>recovery actions that run when the rule conditions are no longer met</p></li>
</ul>
<p>For each action, you must choose a connector, which provides connection information for a service or third party integration.</p>
<DocAccordion buttonContent="Connector types">
Connectors provide a central place to store connection information for services and integrations with third party systems.
The following connectors are available when defining actions for alerting rules:
<Connectors />
<p>For more information on creating connectors, refer to <DocLink slug="/serverless/action-connectors">Connectors</DocLink>.</p>
</DocAccordion>
<DocAccordion buttonContent="Action frequency">
After you select a connector, you must set the action frequency. You can choose to create a **Summary of alerts** on each check interval or on a custom interval. For example, you can send email notifications that summarize the new, ongoing, and recovered alerts at a custom interval:
<p><img alt="UI for defining alert summary action in an PRODUCT_NAME query rule" src="../../_images/alerting-es-query-rule-action-summary.png" /></p>
<!--  NOTE: This is an autogenerated screenshot. Do not edit it directly.-->
<p>Alternatively, you can set the action frequency to <strong>For each alert</strong> and specify the conditions each alert must meet for the action to run.</p>
<p>With the <strong>Run when</strong> menu you can choose how often the action runs (at each check interval, only when the alert status changes, or at a custom action interval).
You must also choose an action group, which indicates whether the action runs when the query is matched or when the alert is recovered.
Each connector supports a specific set of actions for each action group.
For example:</p>
<p><img alt="UI for defining a recovery action" src="../../_images/alerting-es-query-rule-action-query-matched.png" /></p>
<!--  NOTE: This is an autogenerated screenshot. Do not edit it directly.-->
<p>You can further refine the conditions under which actions run by specifying that actions only run when they match a KQL query or when an alert occurs within a specific time frame.</p>
</DocAccordion>
<DocAccordion buttonContent="Action variables">
Use the default notification message or customize it.
You can add more context to the message by clicking the Add variable icon <DocIcon type="indexOpen" title="Add variable" /> and selecting from a list of available variables.
<p><img alt="Action variables list" src="../../_images/action-variables-popup.png" /></p>
<p>The following variables are specific to this rule type.
You can also specify <a class="reference external" href="http://example.co">variables common to all rules</a>/rule-action-variables.html).</p>
<DocDefList>
    <DocDefTerm>`context.conditions`</DocDefTerm>
    <DocDefDescription>
        A string that describes the threshold condition. Example:
        `count greater than 4`.
    </DocDefDescription>
    <DocDefTerm>`context.date`</DocDefTerm>
    <DocDefDescription>
        The date, in ISO format, that the rule met the condition.
        Example: `2022-02-03T20:29:27.732Z`.
    </DocDefDescription>
    <DocDefTerm>`context.hits`</DocDefTerm>
    <DocDefDescription>
        The most recent documents that matched the query. Using the
        [Mustache](https://mustache.github.io/) template array syntax, you can iterate
        over these hits to get values from the PRODUCT_NAME documents into your actions.
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    For example, the message in an email connector action might contain:

    ```
    Elasticsearch query rule &#39;{{rule.name}}&#39; is active:

    {{#context.hits}}
    Document with {{_id}} and hostname {{_source.host.name}} has
    {{_source.system.memory.actual.free}} bytes of memory free
    {{/context.hits}}
    ```

    The documents returned by `context.hits` include the [`_source`](http://example.co)/mapping-source-field.html) field.
    If the PRODUCT_NAME query search API&#39;s [`fields`](http://example.co)/search-fields.html#search-fields-param) parameter is used, documents will also return the `fields` field,
    which can be used to access any runtime fields defined by the [`runtime_mappings`](http://example.co)/runtime-search-request.html) parameter.
    For example:

    &lt;!--  NOTCONSOLE--&gt;
    ```
    {{#context.hits}}
    timestamp: {{_source.@timestamp}}
    day of the week: {{fields.day_of_week}}  \[\^\1]
    {{/context.hits}}
    ```
    \[\^\1]: The `fields` parameter here is used to access the `day_of_week` runtime field.

    As the [`fields`](http://example.co)/search-fields.html#search-fields-response) response always returns an array of values for each field,
    the [Mustache](https://mustache.github.io/) template array syntax is used to iterate over these values in your actions.
    For example:

    ```
    {{#context.hits}}
    Labels:
    {{#fields.labels}}
    - {{.}}
    {{/fields.labels}}
    {{/context.hits}}
    ```
    &lt;!--  NOTCONSOLE--&gt;
&lt;/DocDefDescription&gt;
&lt;DocDefTerm&gt;`context.link`&lt;/DocDefTerm&gt;
&lt;DocDefDescription&gt;
    Link to Discover and show the records that triggered the alert.
&lt;/DocDefDescription&gt;
&lt;DocDefTerm&gt;`context.message`&lt;/DocDefTerm&gt;
&lt;DocDefDescription&gt;
    A message for the alert. Example:
    `rule &#39;my es-query&#39; is active:`
    `- Value: 2`
    `- Conditions Met: Number of matching documents is greater than 1 over 5m`
    `- Timestamp: 2022-02-03T20:29:27.732Z`
&lt;/DocDefDescription&gt;
&lt;DocDefTerm&gt;`context.title`&lt;/DocDefTerm&gt;
&lt;DocDefDescription&gt;
    A title for the alert. Example:
    `rule term match alert query matched`.
&lt;/DocDefDescription&gt;
&lt;DocDefTerm&gt;`context.value`&lt;/DocDefTerm&gt;
&lt;DocDefDescription&gt;
    The value that met the threshold condition.
&lt;/DocDefDescription&gt;
</pre></div>
</div>
</DocDefList>
</DocAccordion>
</section>
<section id="handling-multiple-matches-of-the-same-document">
<h2>Handling multiple matches of the same document<a class="headerlink" href="#handling-multiple-matches-of-the-same-document" title="Link to this heading">¶</a></h2>
<p>By default, <strong>Exclude matches from previous run</strong> is turned on and the rule checks
for duplication of document matches across multiple runs. If you configure the
rule with a schedule interval smaller than the time window and a document
matches a query in multiple runs, it is alerted on only once.</p>
<p>The rule uses the timestamp of the matches to avoid alerting on the same match
multiple times. The timestamp of the latest match is used for evaluating the
rule conditions when the rule runs. Only matches between the latest timestamp
from the previous run and the current run are considered.</p>
<p>Suppose you have a rule configured to run every minute. The rule uses a time
window of 1 hour and checks if there are more than 99 matches for the query. The
(PRODUCT_NAME) query rule type does the following:</p>
<!--  [cols="3*<"]-->
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">1</span> <span class="pre">(0:00)</span></code></p></td>
<td><p>Rule finds 113 matches in the last hour: <code class="docutils literal notranslate"><span class="pre">113</span> <span class="pre">&gt;</span> <span class="pre">99</span></code></p></td>
<td><p>Rule is active and user is alerted.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">2</span> <span class="pre">(0:01)</span></code></p></td>
<td><p>Rule finds 127 matches in the last hour. 105 of the matches are duplicates that were already alerted on previously, so you actually have 22 matches: <code class="docutils literal notranslate"><span class="pre">22</span> <span class="pre">!&gt;</span> <span class="pre">99</span></code></p></td>
<td><p>No alert.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">3</span> <span class="pre">(0:02)</span></code></p></td>
<td><p>Rule finds 159 matches in the last hour. 88 of the matches are duplicates that were already alerted on previously, so you actually have 71 matches: <code class="docutils literal notranslate"><span class="pre">71</span> <span class="pre">!&gt;</span> <span class="pre">99</span></code></p></td>
<td><p>No alert.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">4</span> <span class="pre">(0:03)</span></code></p></td>
<td><p>Rule finds 190 matches in the last hour. 71 of them are duplicates that were already alerted on previously, so you actually have 119 matches: <code class="docutils literal notranslate"><span class="pre">119</span> <span class="pre">&gt;</span> <span class="pre">99</span></code></p></td>
<td><p>Rule is active and user is alerted.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="create-custom-threshold-alert-rule.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Create a custom threshold rule</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="triage-slo-burn-rate-breaches.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Triage SLO burn rate breaches</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Elasticsearch B.V. All Rights Reserved.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Create an Elasticsearch query rule</a><ul>
<li><a class="reference internal" href="#define-the-conditions">Define the conditions</a></li>
<li><a class="reference internal" href="#test-your-query">Test your query</a></li>
<li><a class="reference internal" href="#add-actions">Add actions</a></li>
<li><a class="reference internal" href="#handling-multiple-matches-of-the-same-document">Handling multiple matches of the same document</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=140f00c8"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>